<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OWASP Top 10 - A01: Broken Access Control</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Roboto', Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.07); padding: 32px; }
    h1, h2, h3 { color: #2d3e50; }
    h1 { margin-top: 0; }
    code, pre { background: #f0f0f0; border-radius: 4px; padding: 2px 6px; font-size: 1em; }
    pre { padding: 12px; overflow-x: auto; }
    .owasp-box { background: #e3f2fd; border-left: 5px solid #1976d2; padding: 16px; margin-bottom: 24px; }
    .tutorial-step { margin-bottom: 18px; }
    .tip { background: #fffde7; border-left: 5px solid #ffd600; padding: 12px; margin: 18px 0; }
    ul { margin-top: 0; }
    @media (max-width: 600px) { .container { padding: 12px; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>OWASP Top 10 - A01: Broken Access Control</h1>
    <div class="owasp-box">
      <h2>O que é Broken Access Control?</h2>
      <p><strong>Broken Access Control</strong> é uma das principais vulnerabilidades listadas pelo <a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" target="_blank">OWASP Top 10</a>. Ela ocorre quando aplicações permitem que usuários acessem dados ou funcionalidades além do que deveriam, devido a falhas na validação de permissões.</p>
      <ul>
        <li>Usuários podem acessar, modificar ou excluir dados de outros usuários.</li>
        <li>Exemplo: Um usuário autenticado consegue acessar o perfil de outro usuário apenas alterando um parâmetro na URL.</li>
      </ul>
      <p><strong>Impacto:</strong> Vazamento de dados sensíveis, manipulação indevida de informações, escalonamento de privilégios.</p>
    </div>

    <h2>Laboratório Prático</h2>
    <p>Neste laboratório, você irá explorar e corrigir uma vulnerabilidade de Broken Access Control em uma API Python.</p>

    <h3>Passo a Passo</h3>
    <div class="tutorial-step">
      <strong>1. Pré-requisitos</strong>
      <ul>
        <li>PostgreSQL rodando</li>
        <li>Dependências instaladas: <code>pip install -r ../../requirements.txt</code></li>
        <li>Arquivo <code>.env</code> configurado</li>
        <li>Usuário e banco de dados criados conforme <code>.env</code>:</li>
      </ul>
      <pre><code>CREATE USER "user" WITH PASSWORD 'password';
CREATE DATABASE "owasp_top10_db" OWNER "user";
GRANT ALL PRIVILEGES ON DATABASE "owasp_top10_db" TO "user";
</code></pre>
    </div>
    <div class="tutorial-step">
      <strong>2. Inicie os servidores</strong>
      <ul>
        <li>Servidor de autenticação: <code>python src/shared/auth_server.py</code></li>
        <li>Configure o banco: <code>python auth_helper.py setup</code></li>
        <li>Servidor vulnerável: <code>python src/a01_access_control/server.py</code></li>
        <li>Servidor seguro (opcional): <code>python src/a01_access_control/solution.py</code></li>
      </ul>
    </div>
    <div class="tutorial-step">
      <strong>3. Teste a vulnerabilidade</strong>
      <ul>
        <li>Obtenha um token JWT para <code>alice</code>:</li>
      </ul>
      <pre><code>curl -X POST http://localhost:8000/login \
  -H "Content-Type: application/json" \
  -d '{"username": "alice", "password": "alice123"}'
</code></pre>
      <ul>
        <li>Use o token para acessar o endpoint vulnerável:</li>
      </ul>
      <pre><code>curl -H "Authorization: Bearer SEU_TOKEN_AQUI" \
  "http://localhost:8001/profile?username=bob"
</code></pre>
      <div class="tip">
        <strong>Dica:</strong> Substitua <code>SEU_TOKEN_AQUI</code> pelo valor do token retornado no login.
      </div>
    </div>
    <div class="tutorial-step">
      <strong>4. Teste a correção</strong>
      <ul>
        <li>Use o mesmo token para acessar o servidor seguro:</li>
      </ul>
      <pre><code>curl -H "Authorization: Bearer SEU_TOKEN_AQUI" \
  "http://localhost:8002/profile?username=bob"
</code></pre>
      <p>O servidor seguro deve retornar <code>403 Forbidden</code> se tentar acessar dados de outro usuário.</p>
    </div>

    <h3>Usuários de Teste</h3>
    <ul>
      <li><strong>alice</strong> / senha: <code>alice123</code></li>
      <li><strong>bob</strong> / senha: <code>bob123</code></li>
    </ul>

    <h3>Principais Lições</h3>
    <ul>
      <li>Nunca confie apenas na autenticação: <strong>autorização é fundamental</strong></li>
      <li>Valide permissões antes de retornar dados sensíveis</li>
      <li>Use dados do token JWT, não parâmetros da requisição</li>
      <li>Implemente testes para verificar controles de acesso</li>
      <li>Princípio do menor privilégio: usuários só acessam o que precisam</li>
    </ul>

    <h3>Links Úteis</h3>
    <ul>
      <li><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/" target="_blank">OWASP Top 10 - Broken Access Control</a></li>
      <li><a href="https://fastapi.tiangolo.com/" target="_blank">FastAPI Documentation</a></li>
      <li><a href="https://jwt.io/" target="_blank">JWT.io</a></li>
    </ul>
  </div>
</body>
</html>
